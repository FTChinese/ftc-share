{"version":3,"file":null,"sources":["../src/js/share.js"],"sourcesContent":["// const DomDelegate = require('dom-delegate');\nimport Delegate from 'dom-delegate';\n\nconst socialUrls = {\n\twechat: {\n\t\tname: \"微信\",\n\t\turl: \"http://www.ftchinese.com/m/corp/qrshare.html?title={{title}}&url={{url}}&ccode=2C1A1408\"\n\t},\n\tweibo: {\n\t\tname: \"微博\",\n\t\turl: \"http://service.weibo.com/share/share.php?&appkey=4221537403&url={{url}}&title=【{{title}}】{{summary}}&ralateUid=1698233740&source=FT中文网&sourceUrl=http://www.ftchinese.com/&content=utf8&ccode=2G139005\"\n\t},\n\tlinkedin: {\n\t\tname: \"领英\",\n\t\turl: \"http://www.linkedin.com/shareArticle?mini=true&url={{url}}&title={{title}}&summary={{summary}}&source=FT中文网\"\n\t},\n\tfacebook: {\n\t\tname: \"Facebook\",\n\t\turl: \"http://www.facebook.com/sharer.php?u={{url}}\"\n\t},\n\ttwitter: {\n\t\tname: \"Twitter\",\n\t\turl: \"https://twitter.com/intent/tweet?url={{url}}&amp;text=【{{title}}】{{summary}}&amp;via=FTChinese\"\n\t}\n};\n\nfunction getOgContent(metaEl) {\n\tif (!(metaEl instanceof HTMLElement)) {\n\t\tmetaEl = document.querySelector(metaEl);\n\t}\n\treturn metaEl.hasAttribute('content') ? metaEl.getAttribute('content') : '';\n}\n\n// Get page meta content statically. Should not put this inside the `Share` object in order to reduce DOM traverse.\nconst fallbackConfig = {\n\tlinks: ['wechat', 'weibo', 'linkedin', 'facebook', 'twitter'],\n\n\turl: window.location.href || '',\n\tsummary: getOgContent('meta[property=\"og:description\"]'),\n\ttitle: getOgContent('meta[property=\"og:title\"]')\n};\n\nfunction Share (rootEl, config) {\n\tconst oShare = this;\n\tconst openWindows = {};\n\n\tfunction init() {\n\t\tif (!rootEl) {\n\t\t\trootEl = document.body;\n\t\t} else if (!(rootEl instanceof HTMLElement)) {\n\t\t\trootEl = document.querySelector(rootEl);\n\t\t}\n\n\t\t// const rootDelegate = new DomDelegate(rootEl);\n\t\tconst rootDelegate = new Delegate(rootEl);\n\t\t\n\t\trootDelegate.on('click', 'a', handleClick);\n\t\trootEl.setAttribute('data-o-share--js', '');\n\n\t\toShare.rootDomDelegate = rootDelegate;\n\t\toShare.rootEl = rootEl;\n\n\t\tif (rootEl.children.length === 0) {\n\t\t\tif (!config) {\n\t\t\t\tconfig = {};\n\t\t\t\tconfig.links = rootEl.hasAttribute('data-o-share-links') ? rootEl.getAttribute('data-o-share-links').split(' ') : fallbackConfig.links;\n\t\t\t\tconfig.url = rootEl.getAttribute('data-o-share-url') || fallbackConfig.url;\n\t\t\t\tconfig.title = rootEl.getAttribute('data-o-share-title') || fallbackConfig.title;\n\t\t\t\tconfig.summary = rootEl.getAttribute('data-o-share-summary') || fallbackConfig.summary;\n\t\t\t}\n\t\t\trender();\n\t\t}\n\t}\n\n\tfunction render() {\n\t\tconst ulElement = document.createElement('ul');\n\n\t\tfor (let i = 0; i < config.links.length; i++) {\n\t\t\tconst link = config.links[i];\n\t\t\tconst linkName = socialUrls[link].name;\n\t\t\t\n\t\t\tconst liElement = document.createElement('li');\n\t\t\t//liElement.classList.add('o-share__action', 'o-share__' + link);\n\t\t\tliElement.className = 'o-share__action o-share__' + link;\n\t\t\t\n\t\t\tconst aElement = document.createElement('a');\n\n\t\t\taElement.href = generateSocialUrl(link);\n\t\t\taElement.setAttribute('title', '分享到'+linkName);\n\t\t\taElement.setAttribute('target', '_blank');\n\t\t\t\n\t\t\tconst iElement = document.createElement('i');\n\t\t\tiElement.innerHTML = linkName;\n\t\t\taElement.appendChild(iElement);\n\n\t\t\tliElement.appendChild(aElement);\n\t\t\tulElement.appendChild(liElement);\n\t\t}\n\t\toShare.rootEl.appendChild(ulElement);\n\t}\n\n\tfunction handleClick(e, target) {\n\t\te.preventDefault();\n\t\tshareSocial(target.href);\n\t}\n\n\tfunction shareSocial(url) {\n\t\tif (url) {\n\t\t\tif (openWindows[url] && !openWindows[url].closed) {\n\t\t\t\topenWindows[url].focus();\n\t\t\t} else {\n\t\t\t\topenWindows[url] = window.open(url, '', 'width=646,height=436');\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction generateSocialUrl (socialNetwork) {\n\t\tlet templateUrl = socialUrls[socialNetwork].url;\n\t\ttemplateUrl = templateUrl.replace('{{url}}', encodeURIComponent(config.url))\n\t\t\t.replace('{{title}}', encodeURIComponent(config.title))\n\t\t\t.replace('{{summary}}', encodeURIComponent(config.summary));\n\n\t\treturn templateUrl;\n\t}\n\n\tinit();\n}\n\nShare.prototype.destroy = function() {\n\tthis.rootDomDelegate.destroy();\n\n\tfor (let i = 0; i < this.rootEl.children; i++) {\n\t\tthis.rootEl.removeChild(this.rootEl.chidlren[i]);\n\t}\n\n\tthis.rootEl.removeAttribute('data-o-share--js');\n\tthis.rootEl = undefined;\n};\n\nShare.init = function(el) {\n\tconst shareInstances = [];\n\n\tif (!el) {\n\t\tel =document.body;\n\t} else if (!el instanceof HTMLElement) {\n\t\tel = document.querySelector(el);\n\t}\n\n\tconst shareElements = el.querySelectorAll('[data-o-component=o-share]');\n\n\tfor (let i = 0; i < shareElements.length; i++) {\n\t\tshareInstances.push(new Share(shareElements[i]));\n\n\t}\n\n\treturn shareInstances;\n};\n\nexport default Share;"],"names":["const","let","this"],"mappings":"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"}